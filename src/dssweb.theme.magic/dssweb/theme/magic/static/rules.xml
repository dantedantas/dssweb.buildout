<?xml version="1.0" encoding="UTF-8"?>
<rules
    xmlns="http://namespaces.plone.org/diazo"
    xmlns:css="http://namespaces.plone.org/diazo/css"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <!-- Apply the following rules to standard Plone pages -->
    <rules css:if-content="#visual-portal-wrapper">
	    <theme href="index.html" if="$home_page" />
	    <theme href="t13_event.html" css:if-content="body.portaltype-event" />
        <theme href="t4_adhoc.html" />

        <!-- Replace title with Plone's page title  -->
        <replace css:theme="html head title" css:content="html head title" />

        <!-- Copy base tag from Plone -->
        <before css:theme-children="html head" css:content="html head base" />

        <!-- Copy link, style, meta tags from Plone head -->
        <!-- before css:theme-children="html head"
               content="/html/head/link | /html/head/style | /html/head/meta" / -->
        <before css:theme-children="html head"
               content="/html/head/meta" />

        <!-- merge classes from Plone body with theme body -->
        <merge attributes="class" css:theme="body" css:content="body" />

        <!-- Copy script tags from Plone head to end of body -->
        <!-- after css:theme-children="html body" css:content="html head script" / -->

        <!-- Insert your own rules here -->
		<!--Home Page Rules-->
		<drop css:theme="#content > div.row > div" if="$home_page" />
 	   <!--drop all the portal footers on the front page -->
 	   <drop css:content="dd.portlet-footer" if="$home_page" />
 	   <drop css:content="dd.portletFooter" if="$home_page" />

	   <!--swap in portal-globalnav -->
	   <!--utility menu -->
	   <!--ISS Site Specific Logo and front page -->

	   <before css:theme="#util-bar-wrap > nav" css:content="#iss-top" />

	   <replace css:theme-children="#top-bar-wrap > nav > ul > li.name" css:content="#portal-logo"  />
	   <replace css:theme-children="#left-front-column" css:content=".portletContentLeadImageCollectionPortlet.front-page-events" />
	   <replace css:theme-children="#middle-front-column" css:content=".portletContentLeadImageCollectionPortlet.journal" />
	   <replace css:theme-children="#right-front-column" css:content=".portletContentLeadImageCollectionPortlet.available-grants" />



	   <!--drop the events tab -->
	   <drop content='//*[@id="portaltab-events"]' />
	   <!--utility menu links -->
	   <replace css:theme="#uti-events > a" css:content="#portaltab-events > a" method="raw" />
	   <copy attributes="href" css:content=".news > dl > dd.portletFooter > span:nth-child(2) > a" css:theme="#uti-news > a"  />
	   <copy attributes="href" css:content="#portaltab-support-iss > a" css:theme="#uti-give > a" />


        <replace content="//ul[contains(@class,'submenu')]/@class">
            <xsl:attribute name="class">dropdown</xsl:attribute>
        </replace>
        <replace content="//li[contains(@class,'dropdown')]/@class">
            <xsl:attribute name="class">has-dropdown</xsl:attribute>
        </replace>

	    <replace css:theme="h2.homepage-title" css:content="h1#parent-fieldname-title" />
	    <replace content="//h1[contains(@class,'documentFirstHeading')]/@class" if="$home_page">
	    <xsl:attribute name="class">
	    <xsl:if test='contains(current(),"documentFirstHeading")'>homepage-title</xsl:if>
	    </xsl:attribute>
	    </replace>

	    <replace css:theme="h1.content-title" css:content="h1#parent-fieldname-title" />
	    <replace content="//h1[contains(@class,'documentFirstHeading')]/@class" if-not="$home_page">
	    <xsl:attribute name="class">
	    <xsl:if test='contains(current(),"documentFirstHeading")'>content-title</xsl:if>
	    </xsl:attribute>
	    </replace>


         <drop css:content=".searchSection" />
         <copy css:content="#portal-searchbox" css:theme="#uti-search" />
	    <!-- change search button value to "go" -->
	    <replace content="//div[@id='portal-searchbox']//input[@class='searchButton']/@value">
	    <xsl:attribute name="value">GO</xsl:attribute>
	    </replace>

		<replace css:theme-children="ul.left" css:content-children="#portal-globalnav" />

		<!-- News Happy Box -->
		<replace css:content=".news > dl > dd" css:theme-children="#container-1 > div > div > div.content-wrap"  />
		<copy attributes="href" css:content=".news > dl > dd.portletFooter > span:nth-child(2) > a" css:theme="#container-1 > div > div > div.bcontroller > a"  />

		<!--  About Happy Box -->


		<replace css:content="#content-core" css:theme-children="#container-2 div.content-wrap"  />

		<!-- Events Happy Box -->
	    <copy css:content=".events > dl > dd" css:theme="#container-3 > div > div > div.content-wrap" />
		<copy attributes="href" css:content=".events > dl > dd.portletFooter > span:nth-child(2) > a" css:theme="#container-3 > div > div > div.bcontroller > a"  />
		<!-- Front Page -->
		<copy css:content="#parent-fieldname-title" css:theme="#middle-row" />
		<!-- Breadcrumbs for all but front page -->
		<replace css:theme-children=".breadcrumb" css:content="#portal-breadcrumbs" />
		<drop css:content="#breadcrumbs-you-are-here" />
	<!-- Global Rules -->

	<!-- Description -->
	<replace css:theme="p.intro" css:content="#parent-fieldname-description" />

	<!-- Columns -->
	<!--replace theme='//*[@id="content-row"]' content='//*[@id="portal-columns"]' /-->

	<!-- Content-core-T4 -->
	<replace css:theme-children=".panel-body" css:content="#content-core" if-not="$home_page" />

	<!-- Basic Right Portlet -->
	<replace css:theme-children=".sidebar-right" css:content=".portlet" />

	<!-- Events Page -->
	<replace css:theme="#sidebar-block-contact > li.fn > a" css:content="a.email" />
	<drop css:theme="#sidebar-block-contact > li.category" />
	<replace css:theme="li.tel" css:content="td.tel" />
	<replace css:theme="li.email a" css:content="a.email" />

    <replace css:content=".breadcrumbSeparator">
        <span class="bread-divider">|</span>
    </replace>

	  <!--- Footer -->
	   <copy  css:content=".portletStaticText.portlet-static-contact" css:theme="#vcard" />

	   <replace css:theme-children="#footer-nav-middle"  css:content="ul#footer-nav" method="raw"/>




<!--
       <before css:theme="#wallpaper_fix">
            <div style="display:none" id="theme_url"><xsl:value-of select="$theme_url" /></div>
       </before>
-->

       <replace css:theme="#wallpaper_fix">
            <script id="wallpaper_fix">
                $(".wall").wallpaper({
                    source: "@@banner-image"
                });
            </script>
       </replace>

    <after theme-children="html/body">
      <script type="text/javascript">
        jQuery(function ($) {
            var mmenu = $('#portal-globalnav li > ul.dropdown');

            $('#portal-globalnav').hover(
                function() {
                    mmenu.slideDown('fast');
                },
                function() {
                    mmenu.hide();
                }
            );
        });
      </script>
    </after>

        <rules css:if-content="body.portaltype-event">
            <!-- rules for the event portal type -->
            <replace theme="//div[@id='content-core']/div/img"
                     content="//*[@id='parent-fieldname-leadImage']/img" />

            <replace css:theme="#event-speakers p.attendees"
                     css:content="td.attendees" />
            <replace css:theme="#event-datetime p.datetime"
                     content=".//*[@id='content-core']/div[1]/table/tbody/tr[1]/td" />
            <replace css:theme="#event-location p.location"
                     content=".//*[@id='content-core']/div[1]/table/tbody/tr[2]/td" />
            <replace css:theme="#event-description .inline-content"
                     content=".//*[@id='content-core']/div[2]" />
            <replace css:theme-children="#event-cta .portlet-items"
                     content=".//*[@id='content-core']/div[1]/table/tbody/tr[6]/td" />
        </rules>

        <after css:content="#portal-globalnav" css:theme=".top-bar ul.title-area" />

    </rules>

    <xsl:template match="img[@class='newsImage']/@src">
        <xsl:attribute name="src"><xsl:value-of select="concat(substring-before(., '_mini'), '_large')" /></xsl:attribute>
    </xsl:template>
    <xsl:template match="img[@class='newsImage']/@height"></xsl:template>
    <xsl:template match="img[@class='newsImage']/@width"></xsl:template>
    <xsl:template match="img[@class='newsImage']/@class">
        <xsl:attribute name="class">img-responsive</xsl:attribute>
    </xsl:template>

</rules>
